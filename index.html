<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VLONE IPTV</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/ZrYMYLQ.png">
    <link rel="stylesheet" href="https://github.com/Chaewonblight/Vlone-IPTV-Stream/blob/main/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.0/hls.min.js"></script>
	<script src="https://dunggramer.github.io/disable-devtool/disable-devtool.min.js" defer></script>
</head>
<body>
    <h1><i>vlone iptv.</i></h1>
    <div id="video-container">
        <video id="video-player" controls autoplay></video>
    </div>

    <div id="channel-selector"></div>

    <div class="navigation-buttons">
        <button class="navigation-button" id="prev-page">ðŸ¡¸</button>
        <button class="navigation-button" id="next-page">ðŸ¡º</button>
    </div>

    <script>
        const channelData = [
            {
                src: "https://linearjitp02-playback.astro.com.my/dash-wv/linear/9983/default.mpd",
                img: "https://i.imgur.com/Nd9gqA2.png",
                name: "KPLUS",
                key: "aa48b28bd723f91214887df6ed9fad10:b5a3a800848120c843ae0fa68c09c261"
            },
            { src: "https://jungotvstream-chanall.akamaized.net/jungotv/hallypop/stream.m3u8", img: "https://i.imgur.com/TT27L6j.png", name: "HALLYPOP" }
        ];

        const pageSize = 12;
        let currentPage = 0;
        let activeTile = null;
        let activeTileIndex = null;

        function loadTiles(page) {
            const start = page * pageSize;
            const end = start + pageSize;
            const tiles = channelData.slice(start, end);
            const selector = document.getElementById('channel-selector');
            selector.innerHTML = '';
            tiles.forEach((channel, index) => {
                const tile = document.createElement('div');
                tile.classList.add('tile');
                tile.setAttribute('data-source', channel.src);
                if (channel.key) tile.setAttribute('data-key', channel.key);
                tile.innerHTML = `
                    <img src="${channel.img}" alt="${channel.name}">
                    <span>${channel.name}</span>
                `;
                selector.appendChild(tile);

                if (activeTileIndex !== null && start + index === activeTileIndex) {
                    updateActiveTile(tile);
                }
            });
        }

        function updateActiveTile(tile) {
            if (activeTile) {
                activeTile.classList.remove('active');
            }
            tile.classList.add('active');
            activeTile = tile;
        }

        document.getElementById('prev-page').addEventListener('click', () => {
            if (currentPage > 0) {
                currentPage--;
                loadTiles(currentPage);
            }
        });

        document.getElementById('next-page').addEventListener('click', () => {
            if (currentPage < Math.ceil(channelData.length / pageSize) - 1) {
                currentPage++;
                loadTiles(currentPage);
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const video = document.getElementById('video-player');
            const player = new shaka.Player(video);

            async function loadVideo(manifestUri, keySystem = null) {
                const isHLS = manifestUri.endsWith('.m3u8');
                if (isHLS && Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(manifestUri);
                    hls.attachMedia(video);
                } else {
                    const config = keySystem ? { drm: { clearKeys: parseClearKey(keySystem) } } : {};
                    player.configure(config);
                    await player.load(manifestUri);
                }
                video.play();
            }

            function parseClearKey(keyString) {
                const keys = keyString.split(',');
                const keyObject = {};
                keys.forEach(pair => {
                    const [keyId, key] = pair.split(':');
                    keyObject[keyId] = key;
                });
                return keyObject;
            }

            document.getElementById('channel-selector').addEventListener('click', function(event) {
                const tile = event.target.closest('.tile');
                if (tile) {
                    const source = tile.getAttribute('data-source');
                    const key = tile.getAttribute('data-key') || null;
                    loadVideo(source, key);
                    updateActiveTile(tile);
                }
            });        
			
            document.addEventListener('contextmenu', (e) => e.preventDefault());

            function ctrlShiftKey(e, keyCode) {
              return e.ctrlKey && e.shiftKey && e.keyCode === keyCode.charCodeAt(0);
            }

            document.onkeydown = (e) => {
            if (
              event.keyCode === 123 ||
              ctrlShiftKey(e, 'I') ||
              ctrlShiftKey(e, 'J') ||
              ctrlShiftKey(e, 'C') ||
              (e.ctrlKey && e.keyCode === 'U'.charCodeAt(0))
            )
              return false;
            };
        });

        loadTiles(currentPage);
    </script>
</body>
</html>
